


<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Scripts/toastr.js"></script>
<script src="~/Scripts/toastr.min.js"></script>
<link href="~/assets/css/plugins/toastr/toastr.css" rel="stylesheet" />
<script src="~/assets/css/plugins/toastr/toastr.min.js"></script>
<link href="~/assets/css/plugins/toastr/toastr.min.css" rel="stylesheet" />

@model mvc.Models.Requirement


@{

    Layout = null;
}

<!DOCTYPE html>

<div class="modal-dialog" id="pnl-mdlCandidate">
    @using (Html.BeginForm(null, null, FormMethod.Post, new { @class = "", @id = "frmCandidate" }))
    {
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" id="cccc">&times;</button>
                <h3 class="modal-title">Add Locations</h3>
            </div>

            <div class="modal-body">
            
                <div class="form-horizontal">

                    <div class="form-group">
                        <label class="control-label col-md-3">
                            Location Name
                        </label>
                        <div class="col-md-4">

                            @Html.TextBoxFor(a => a.Location, new { @class = "form-control ", @id = "productName", placeholder = "productName" })
                            @Html.HiddenFor(a => a.location_id, new { @id = "price", @name = "price" })

                        </div>

                        <div class="col-md-3">
                            <a id="add" class="btn btn-primary">Add </a>
                        </div>
                    </div>


                    <table id="detailsTable" class="table">
                        <thead>
                            <tr>
                                <th style="width:30%">location</th>

                                <th style="width:20%">Location Id</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">

                <button type="submit" id="aaaa" name="aaaa" class="btn btn-primary">Save</button>
                <button type="button" id="kkkk" name="kkkk" class="btn btn-primary">Cancel</button>
               

            </div>

        </div>
    }
</div>
<script>


   
    $("#aaaa").click(function (e) {
        e.preventDefault();

        var orderArr = [];
        orderArr.length = 0;

        $.each($("#detailsTable tbody tr"), function () {
            orderArr.push({
                productName: $(this).find('td:eq(0)').html(),
                price: $(this).find('td:eq(1)').html(),
               
            });
        });
        
        var data = JSON.stringify({
            Requirement: orderArr
        });

        $.when(saveOrder(data)).then(function (response) {
            console.log(response);
        }).fail(function (err) {
            console.log(err);
        });
    });

    function saveOrder(data) {

             return $.ajax({
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            type: 'POST',
            url: "/Placement/add_MultipalLocation",
            data: data,
            success: function (result) {
                toastr.success("Location Added successfully.");;
               // location.reload();
                $("#mdlAddDesignationForManual .close").click()
            },
            error: function () {
                alert("Error!")
            }
        });
    }

    
    $("#add").click(function (e) {
        //alert('hi');
        e.preventDefault();

        if ($.trim($("#productName").val()) == "" || $.trim($("#price").val()) == "") return;

        var productName = $("#productName").val(),
            price = $("#price").val(),
            detailsTableBody = $("#detailsTable tbody");

        var productItem = '<tr><td>' + productName + '</td><td>' + price + '</td><td><a data-itemId="0" href="#" class="deleteItem">Remove</a></td></tr>';
        detailsTableBody.append(productItem);
        clearItem();
    });
    //After Add A New Order In The List, Clear Clean The Form For Add More Order.
    function clearItem() {
        $("#productName").val('');
        $("#price").val('');
        // $("#quantity").val('');
    }
    // After Add A New Order In The List, If You Want, You Can Remove It.
    $(document).on('click', 'a.deleteItem', function (e) {
        e.preventDefault();
        var $self = $(this);
        if ($(this).attr('data-itemId') == "0") {
            $(this).parents('tr').css("background-color", "#ff6347").fadeOut(800, function () {
                $(this).remove();
            });
        }
    });


    $(document).ready(function () {
        getLocation();

    });

    function getLocation()
    {
             var returnResult = [];
                          $.ajax({
                        contentType: "application/json; charset=utf-8",
                         url: "@Url.Action("GetLocationList", "placement")",
                        method: 'GET',
                        async: 'false',
                        dataType: 'json',
                        success: function (result) {
                            var data = $.map(result, function (obj) {
                                obj.value = obj.Text; // desired field
                                obj.data = obj.Value; // desired field
                                returnResult.push(obj);
                                $("#productName").autocomplete({
                                    lookup: returnResult,
                                    onSelect: function (suggestion) {
                                      $("#price").val(suggestion.data);
                                    }
                                });

                            });
                        },
                        error: function () { }
                  });
    }

    $("#cccc").click(function (e) {
        CloseModalPopup();
    });
    function CloseModalPopup() {
      $("#mdlAddDesignationForManual").modal('hide');
     
    }

    $("#kkkk").click(function (e) {
        CloseModalPopup();
    });
  
    
    //$("#aaaa").click(function () {
    //    $.ajax({
    //        type: 'POST',
    //        dataType: 'json',
    //        url: '/Placement/add_MultipalLocation',
    //        data:
    //            {

    //                location_id: $("#price").val(),

    //            },
    //        success: function (da) {
    //            //alert("data inserted sucessfully");
    //            toastr.success("Location added successfully.");
    //            $("#mdlAddDesignationForManual .close").click()
    //        },

    //        error: function (XMLHttpRequest, textStatus, errorThrown) {

    //        }
    //    });
    //    return false;
    //});


</script>



